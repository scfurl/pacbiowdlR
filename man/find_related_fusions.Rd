% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fusionplot.R
\name{find_related_fusions}
\alias{find_related_fusions}
\title{Find Closest Related Fusions in a Reference Catalogue}
\usage{
find_related_fusions(
  sequenced_fusions,
  db_fusions,
  max_results = 5,
  verbose = F
)
}
\arguments{
\item{sequenced_fusions}{A \code{data.frame} (or \code{data.table}) produced
by \code{annotate_genomic_coordinates()} containing, at minimum, the
columns
\itemize{
  \item \code{chr1}, \code{chr2}
  \item \code{bp1_gene}, \code{bp2_gene}
  \item \code{bp1_gene_strand}, \code{bp2_gene_strand}
  \item \code{bp1_feature},  \code{bp2_feature}
  \item exon‑proximity columns: \code{bp[12]\_within_exon},
    \code{bp[12]\_fiveprime_exon}, \code{bp[12]\_threeprime_exon}.
}}

\item{db_fusions}{A reference fusion catalogue as a
\code{data.frame}/\code{data.table} with at least the columns
\code{gene1}, \code{gene2}, \code{gene1_chro}, \code{gene2_chro},
\code{gene1_strand}, \code{gene2_strand},
\code{gene1_exonnumber}, \code{gene2_exonnumber}, and \code{fusion_id}.}

\item{max_results}{Integer.  Maximum number of highest‑scoring database
fusions returned for each sequenced fusion (default \code{5}).}

\item{verbose}{Logical. if \code{TRUE}, will provide messaging.}
}
\value{
A named list.  Each element corresponds to one row in
  \code{sequenced_fusions} and contains up to \code{max_results} sub‑lists,
  each with:
  \itemize{
    \item \code{db_index} – row index in \code{db_fusions}
    \item \code{fusion_id} – identifier from the reference catalogue
    \item \code{score} – composite similarity score
    \item \code{gene1}, \code{gene2} – gene symbols in reference fusion
    \item \code{gene1_exon}, \code{gene2_exon} – reference exon numbers
    \item \code{match_details} – short human‑readable description
  }
}
\description{
Given a set of observed (sequenced) fusions that already carry exon–level
breakpoint annotations, search a reference fusion database and return the
\code{max_results} most similar events for every observed fusion.
}
\details{
Similarity is evaluated with a composite score made up of:
\describe{
  \item{Gene‐pair match}{+100 if the gene symbols match (either orientation).}
  \item{Strand concordance}{+50 if the strand orientations also match.}
  \item{Breakpoint exon proximity}{Up to +30 per partner, scaled as
    \eqn{30/(|d|+1)} where \eqn{d} is the absolute difference between the
    observed and reference exon numbers.  Both five‑prime and three‑prime
    nearest exons are considered.}
  \item{Breakpoint context}{+20 for each partner when both the observed and
    reference fusion breakpoints occur in exon sequence (or both in intron
    sequence).}
}
Only candidates with a final score \eqn{> 5} are retained.


Internally, two lookup hash tables are created for the reference database:
one keyed on gene‑pair (\code{gene1--gene2}) and one on chromosome‑pair
(\code{chr1_chr2}).  These drastically reduce the number of candidates that
must be scored for each observed fusion.

The helper \code{calc\_score()} function (defined inside
\code{find_related_fusions()}) implements the scoring scheme described
above.  Scores \eqn{\le 5} are treated as noise and the corresponding
matches are discarded.
}
\examples{
\donttest{
related <- find_related_fusions(sequenced_fusions, db_fusions, max_results = 3)
related[[1]]            # top matches for the first observed fusion
}
}
\author{
Your Name
}
\keyword{internal}
