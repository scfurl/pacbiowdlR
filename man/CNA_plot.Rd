% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cna_plot.R
\name{CNA_plot}
\alias{CNA_plot}
\title{CNA Plot: Generate a Genome-Wide CNA Plot}
\usage{
CNA_plot(
  depth_bigwig_file,
  variant_file,
  txdb,
  method = c("fit", "delta", "loess"),
  gene_delta_threshold = 2,
  downsample = 0.1,
  point_size = 0.01,
  line_size = 0.1,
  line_color = "red",
  colors = NULL,
  max_value = NULL,
  min_value = NULL,
  min_variant_distance = 10000,
  samplename = "",
  chr_filter = NULL,
  trend_window = 50,
  apply_weight = TRUE,
  outside_weight = 0.25,
  inside_weight = 1,
  variant_alpha = 0.1,
  trend_regions = "inside",
  exclude_xy = TRUE,
  return_data = FALSE
)
}
\arguments{
\item{depth_bigwig_file}{Character. File path to a BigWig file containing depth/coverage information.}

\item{variant_file}{Character. File path to a variant call file (VCF) containing structural variant information.}

\item{txdb}{A transcript database object (e.g., from the GenomicFeatures package) used for gene annotation.}

\item{method}{Character. One of \code{"fit"}, \code{"delta"}, or \code{"loess"} determining the method to compute delta values.
Only the first element of the provided vector is used.}

\item{gene_delta_threshold}{Numeric. Threshold applied to the delta values for gene annotation.}

\item{downsample}{Numeric. Proportion of coverage data to retain (e.g., 0.01 for 1 percent).}

\item{point_size}{Numeric. Size of the plotted data points.}

\item{line_size}{Numeric. Size of the plotted trend line.}

\item{line_color}{Character. Color for the trend line.}

\item{colors}{Named vector of colors for chromosomes. If \code{NULL}, an alternating palette of black/gray is used.}

\item{max_value}{Numeric. Maximum allowed delta value; values above this are capped.}

\item{min_value}{Numeric. Minimum allowed delta value; values below this are capped.}

\item{min_variant_distance}{Numeric. Minimum distance (in bp) for a variant call to be retained.}

\item{samplename}{Character. A label for the sample that is appended to the plot title.}

\item{chr_filter}{Character. If specified, only data from the given chromosome are processed.}

\item{trend_window}{Integer. The number of consecutive data points over which to compute the running median trend line.}

\item{apply_weight}{Logical. If \code{TRUE}, weight multipliers are applied to delta values outside CNA calls.}

\item{outside_weight}{Numeric. Multiplier applied to delta values outside CNA calls.}

\item{inside_weight}{Numeric. Multiplier applied to delta values inside CNA calls.}

\item{variant_alpha}{Numeric. Transparency level for variant rectangles.}

\item{trend_regions}{Character. One of \code{"both"}, \code{"inside"}, or \code{"outside"} to control where the trend line is plotted.
Default is \code{"both"}.}

\item{exclude_xy}{Logical. If \code{TRUE}, chromosomes X and Y are excluded from the analysis.}

\item{return_data}{Logical. If \code{TRUE}, returns a list containing the plot, the coverage data, and variant calls.}
}
\value{
Either a \code{ggplot2} object representing the CNA plot or a list with additional processed data when \code{return_data} is \code{TRUE}.
}
\description{
This function creates a genome-wide copy number alteration (CNA) plot from a BigWig depth file and a VCF variant file.
It computes delta values using one of three methods ("fit", "delta", or "loess"), downsampling the coverage data,
and overlays variant calls as rectangles. A running median trend line is computed on weighted delta values.
}
\details{
The function performs several steps:
\enumerate{
  \item Imports coverage data from the BigWig file using \code{import.bw()} and keeps only standard chromosomes (with \code{keepStandardChromosomes()}).
  \item Optionally loads external GC/repeat data when using the "fit" method.
  \item Filters and down-samples the coverage data.
  \item Computes delta values using the specified method:
        \itemize{
          \item[\code{"delta"}] subtracts the mean coverage.
          \item[\code{"loess"}] fits a LOESS model and computes log2 ratios.
          \item[\code{"fit"}] fits a linear model to predict coverage based on GC content and repeat fraction.
        }
  \item Reads and filters variant calls from the VCF file.
  \item Computes genomic offsets via \code{generate_offsets()} (assumed to be defined elsewhere).
  \item Applies weighting to delta values and computes a running median trend line using \code{rollapply()}.
  \item Based on the value of \code{trend_regions}, the trend line is shown only for regions:
        \itemize{
          \item \code{"inside"}: only within CNV call regions,
          \item \code{"outside"}: only outside CNV call regions, or
          \item \code{"both"}: across all regions (the default).
        }
  \item Builds the plot with \code{ggplot2} incorporating points, trend line, variant rectangles, and chromosome boundaries.
}
}
\note{
This function assumes that the helper function \code{generate_offsets()} is defined in your package.
}
\keyword{internal}
