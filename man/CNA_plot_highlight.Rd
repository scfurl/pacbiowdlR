% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cna_plot.R
\name{CNA_plot_highlight}
\alias{CNA_plot_highlight}
\title{CNA Plot with Gene Highlighting}
\usage{
CNA_plot_highlight(
  depth_bigwig_file,
  variant_file,
  txdb,
  org,
  gene_delta_threshold = 2,
  downsample = 0.1,
  point_size = 0.01,
  line_size = 0.1,
  line_color = "red",
  colors = NULL,
  max_value = NULL,
  min_value = NULL,
  min_variant_distance = 10000,
  method = c("fit", "delta", "loess"),
  trend_window = 50,
  apply_weight = TRUE,
  outside_weight = 0.25,
  inside_weight = 1,
  variant_alpha = 0.1,
  nudge_y = 3,
  samplename = "",
  chr_filter = NULL,
  exclude_xy = FALSE,
  highlight_genes = NULL,
  gband_file = file.path("~/develop/pacbiowdlR/cytobands.tsv"),
  gband_y_offset = -0.2,
  gband_text_size = 2,
  showCNAbands = FALSE,
  trend_regions = "both",
  return_data = FALSE
)
}
\arguments{
\item{depth_bigwig_file}{Character. File path to a BigWig file containing coverage depth data.}

\item{variant_file}{Character. File path to a VCF file with variant data.}

\item{txdb}{A transcript database object used for gene annotation.}

\item{org}{A species annotation object (e.g., \code{org.Hs.eg.db}) for mapping gene identifiers.}

\item{gene_delta_threshold}{Numeric. Delta threshold for gene annotation filtering.}

\item{downsample}{Numeric. Proportion of the coverage data to retain after downsampling.}

\item{point_size}{Numeric. Size of individual points in the plot.}

\item{line_size}{Numeric. Size of the trend line.}

\item{line_color}{Character. Color of the trend line.}

\item{colors}{Named vector of colors for chromosomes; if \code{NULL}, defaults to an alternating palette.}

\item{max_value}{Numeric. Maximum allowed delta value; values above this are capped.}

\item{min_value}{Numeric. Minimum allowed delta value; values below this are capped.}

\item{min_variant_distance}{Numeric. Minimum variant length (in bp) to include.}

\item{method}{Character. One of \code{"fit"}, \code{"delta"}, or \code{"loess"} determining the method used to compute delta values.}

\item{trend_window}{Integer. Window size for computing the running median trend line.}

\item{apply_weight}{Logical. If \code{TRUE}, applies a weight multiplier to delta values outside CNA calls.}

\item{outside_weight}{Numeric. Weight multiplier applied to delta values outside CNA calls.}

\item{inside_weight}{Numeric. Weight multiplier applied to delta values inside CNA calls.}

\item{variant_alpha}{Numeric. Transparency level for variant call rectangles.}

\item{nudge_y}{Numeric. Vertical nudge for positioning gene labels.}

\item{samplename}{Character. Sample label used in the plot title.}

\item{chr_filter}{Character. If provided, restricts the analysis to the specified chromosome.}

\item{exclude_xy}{Logical. If \code{TRUE}, chromosomes X and Y are excluded.}

\item{highlight_genes}{Character vector. Specific gene symbols to highlight in the plot.}

\item{gband_file}{Character. File path to a cytogenetic band data file (e.g., a TSV file).}

\item{gband_y_offset}{Numeric. Vertical offset for G-band label placement.}

\item{gband_text_size}{Numeric. Text size for G-band labels.}

\item{showCNAbands}{Logical. If \code{TRUE}, displays G-band annotations on the plot.}

\item{trend_regions}{Character. One of \code{"both"}, \code{"inside"}, or \code{"outside"}.
This option controls where the running median trend line is displayed:
\describe{
  \item{\code{"both"}}{Trend line is plotted for all points (default).}
  \item{\code{"inside"}}{Trend line is only plotted for positions that fall within variant regions.}
  \item{\code{"outside"}}{Trend line is only plotted for positions that fall outside variant regions.}
}}

\item{return_data}{Logical. If \code{TRUE}, returns a list containing the plot, the coverage data, variant calls, and gene annotations.}
}
\value{
Either a \code{ggplot2} object representing the CNA plot with gene highlights, or a list with additional data when \code{return_data} is \code{TRUE}.
}
\description{
Generates a genome-wide CNA plot with additional gene annotation and labeling.
This function extends \code{CNA_plot} by annotating gene coordinates (using
\code{annotateCoverageWithGenes()}) and optionally highlighting selected genes
and cytogenetic (G-band) features.
}
\details{
The function performs several steps:
\enumerate{
  \item Imports and filters coverage data from the BigWig file using \code{import.bw()} and retains standard chromosomes (using \code{keepStandardChromosomes()}).
  \item Optionally loads external GC/repeat data when using the \code{"fit"} method.
  \item Downsamples the coverage data.
  \item Computes delta values using the specified method:
        \itemize{
          \item[\code{"delta"}] subtracts the mean coverage.
          \item[\code{"loess"}] fits a LOESS model and computes log2 ratios.
          \item[\code{"fit"}] fits a linear model to predict coverage based on GC content and repeat fraction.
        }
  \item Reads and filters variant calls from the VCF file.
  \item Computes genomic offsets via \code{generate_offsets()} and marks variant regions.
  \item Applies weighting to delta values with different multipliers for points inside and outside CNV calls.
  \item Computes a running median trend line using \code{rollapply()}, and, based on \code{trend_regions},
        subsets the trend line to display only points inside variants, outside variants, or in both regions.
  \item Annotates gene information on the coverage data using \code{annotateCoverageWithGenes()}.
  \item Constructs the final plot with \code{ggplot2} showing data points, the trend line, variant rectangles, and gene labels (with optional G-band annotations).
}
}
\keyword{internal}
